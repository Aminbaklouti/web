<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Padel Scoreboard - Padel For Everyone (PFE)</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
      :root {
        --pfe-primary: #2ecc71;
        --pfe-secondary: #27ae60;
        --pfe-accent: #f39c12;
        --pfe-dark: #2c3e50;
        --pfe-light: #ecf0f1;
        --team1-color: #3498db;
        --team2-color: #e74c3c;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 10px;
        background: linear-gradient(135deg, var(--pfe-light) 0%, #bdc3c7 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        text-align: center;
        background: linear-gradient(
          135deg,
          var(--pfe-primary),
          var(--pfe-secondary)
        );
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .header h1 {
        margin: 0 0 5px 0;
        font-size: 28px;
        font-weight: bold;
      }

      .header p {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
      }

      .scoreboard {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        flex-grow: 1;
      }

      .match-info {
        text-align: center;
        margin-bottom: 15px;
        padding: 10px;
        background-color: var(--pfe-light);
        border-radius: 8px;
        font-weight: 600;
        color: var(--pfe-dark);
      }

      .teams {
        display: flex;
        gap: 15px;
        height: 100%;
      }

      .team {
        flex: 1;
        text-align: center;
        padding: 15px;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .team:hover {
        transform: translateY(-2px);
      }

      .team-1 {
        background: linear-gradient(135deg, var(--team1-color), #2980b9);
        color: white;
      }

      .team-2 {
        background: linear-gradient(135deg, var(--team2-color), #c0392b);
        color: white;
      }

      .team-name {
        font-size: 22px;
        margin-bottom: 15px;
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .scores {
        display: flex;
        gap: 10px;
        margin-top: auto;
        flex-grow: 1;
      }

      .score-section {
        flex: 1;
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        cursor: pointer;
        transition: all 0.2s ease;
        backdrop-filter: blur(10px);
      }

      .score-section:hover {
        background-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .score-section:active {
        transform: scale(0.98);
      }

      .score-label {
        font-size: 13px;
        margin-bottom: 8px;
        opacity: 0.9;
        font-weight: 600;
      }

      .score-value {
        font-size: 40px;
        padding: 10px;
        border-radius: 6px;
        margin: 0;
        font-weight: 700;
        transition: all 0.2s ease;
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(255, 255, 255, 0.3);
      }

      .controls {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-top: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .control-section {
        margin-bottom: 15px;
      }

      .control-section h3 {
        margin: 0 0 10px 0;
        color: var(--pfe-dark);
        font-size: 16px;
      }

      .format-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .format-option {
        flex: 1;
        padding: 12px;
        border: 2px solid var(--pfe-light);
        border-radius: 8px;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        font-weight: 600;
      }

      .format-option:hover {
        border-color: var(--pfe-primary);
        transform: translateY(-2px);
      }

      .format-option.active {
        background: linear-gradient(
          135deg,
          var(--pfe-primary),
          var(--pfe-secondary)
        );
        color: white;
        border-color: var(--pfe-primary);
      }

      .format-option input[type="radio"] {
        display: none;
      }

      .control-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      button {
        border: none;
        padding: 14px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 16px;
        font-weight: 600;
        flex: 1;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      button:active {
        transform: scale(0.98);
      }

      .plus {
        background: linear-gradient(
          135deg,
          var(--pfe-primary),
          var(--pfe-secondary)
        );
        color: white;
      }

      .minus {
        background: linear-gradient(135deg, var(--pfe-accent), #e67e22);
        color: white;
      }

      .reset {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
      }

      input[type="text"] {
        padding: 12px;
        width: 100%;
        border: 2px solid var(--pfe-light);
        border-radius: 8px;
        margin-bottom: 10px;
        font-size: 15px;
        transition: border-color 0.2s ease;
      }

      input[type="text"]:focus {
        outline: none;
        border-color: var(--pfe-primary);
      }

      .serving-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        background-color: var(--pfe-accent);
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(1.1);
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 24px;
        }
        .team-name {
          font-size: 18px;
        }
        .score-value {
          font-size: 32px;
        }
        .score-label {
          font-size: 12px;
        }
        button {
          padding: 12px 16px;
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        .teams {
          flex-direction: column;
        }
        .score-value {
          font-size: 36px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸŽ¾ Padel For Everyone (PFE) ðŸŽ¾</h1>
        <p>Live Match Scoreboard</p>
        <img src="PFE.png" alt="img" />
      </div>

      <div class="scoreboard">
        <div class="match-info" id="matchInfo">
          Current Set: 1 | Regular Game
        </div>

        <div class="teams">
          <div class="team team-1">
            <div class="team-name">
              <span id="team1Name">Team 1</span>
              <span
                id="serve1"
                class="serving-indicator"
                style="display: none"
              ></span>
            </div>
            <div class="scores">
              <div class="score-section" onclick="handlePoint('team1')">
                <div class="score-label">Sets</div>
                <div class="score-value" id="team1Sets">0</div>
              </div>
              <div class="score-section" onclick="handlePoint('team1')">
                <div class="score-label">Games</div>
                <div class="score-value" id="team1Games">0</div>
              </div>
              <div class="score-section" onclick="handlePoint('team1')">
                <div class="score-label">Points</div>
                <div class="score-value" id="team1Points">0</div>
              </div>
            </div>
          </div>

          <div class="team team-2">
            <div class="team-name">
              <span id="team2Name">Team 2</span>
              <span
                id="serve2"
                class="serving-indicator"
                style="display: none"
              ></span>
            </div>
            <div class="scores">
              <div class="score-section" onclick="handlePoint('team2')">
                <div class="score-label">Sets</div>
                <div class="score-value" id="team2Sets">0</div>
              </div>
              <div class="score-section" onclick="handlePoint('team2')">
                <div class="score-label">Games</div>
                <div class="score-value" id="team2Games">0</div>
              </div>
              <div class="score-section" onclick="handlePoint('team2')">
                <div class="score-label">Points</div>
                <div class="score-value" id="team2Points">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="control-section">
          <h3>Match Format</h3>
          <div class="format-selector">
            <label class="format-option active" id="formatSuper">
              <input
                type="radio"
                name="matchFormat"
                value="supertiebreak"
                checked
                onclick="setMatchFormat('supertiebreak')"
              />
              Super Tie-break (to 10)
            </label>
            <label class="format-option" id="formatThird">
              <input
                type="radio"
                name="matchFormat"
                value="thirdset"
                onclick="setMatchFormat('thirdset')"
              />
              Third Set
            </label>
          </div>
        </div>

        <div class="control-section">
          <h3>Team Names</h3>
          <input
            type="text"
            id="team1NameInput"
            placeholder="Enter Team 1 Name"
          />
          <input
            type="text"
            id="team2NameInput"
            placeholder="Enter Team 2 Name"
          />
        </div>

        <div class="control-section">
          <h3>Score Points</h3>
          <div class="control-row">
            <button class="plus" onclick="handlePoint('team1')">
              + Team 1 Point
            </button>
            <button class="minus" onclick="adjustPoints('team1', -1)">
              - Team 1 Point
            </button>
          </div>
          <div class="control-row">
            <button class="plus" onclick="handlePoint('team2')">
              + Team 2 Point
            </button>
            <button class="minus" onclick="adjustPoints('team2', -1)">
              - Team 2 Point
            </button>
          </div>
        </div>

        <button class="reset" onclick="resetAll()">ðŸ”„ Reset Match</button>
      </div>
    </div>

    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBHOL7RwvYyxRRxl_UG_mMbmO6O-ueLDTc",
        authDomain: "padel-e850d.firebaseapp.com",
        projectId: "padel-e850d",
        storageBucket: "padel-e850d.firebasestorage.app",
        messagingSenderId: "83720478126",
        appId: "1:83720478126:web:d0ae29e91cba747205fc3f",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const scoreboardRef = db.collection("scoreboards3").doc("currentMatch");

      // Game State
      let gameState = {
        team1Name: "Team 1",
        team2Name: "Team 2",
        team1Sets: 0,
        team2Sets: 0,
        team1Games: 0,
        team2Games: 0,
        team1Points: 0,
        team2Points: 0,
        isTiebreak: false,
        currentSet: 1,
        servingTeam: "team1",
        matchFormat: "supertiebreak", // "supertiebreak" or "thirdset"
      };

      let isUpdating = false;

      // Initialize Firestore
      scoreboardRef.get().then((doc) => {
        if (!doc.exists) {
          scoreboardRef.set(gameState);
        }
      });

      // Real-time Listener
      scoreboardRef.onSnapshot((doc) => {
        if (doc.exists && !isUpdating) {
          gameState = doc.data();
          updateUI();
        }
      });

      function updateUI() {
        document.getElementById("team1Name").textContent = gameState.team1Name;
        document.getElementById("team2Name").textContent = gameState.team2Name;
        document.getElementById("team1Sets").textContent = gameState.team1Sets;
        document.getElementById("team2Sets").textContent = gameState.team2Sets;
        document.getElementById("team1Games").textContent =
          gameState.team1Games;
        document.getElementById("team2Games").textContent =
          gameState.team2Games;

        // Display points correctly
        if (gameState.isTiebreak) {
          document.getElementById("team1Points").textContent =
            gameState.team1Points;
          document.getElementById("team2Points").textContent =
            gameState.team2Points;
        } else {
          document.getElementById("team1Points").textContent = formatPoints(
            gameState.team1Points,
            gameState.team2Points
          );
          document.getElementById("team2Points").textContent = formatPoints(
            gameState.team2Points,
            gameState.team1Points
          );
        }

        // Update match info
        const setInfo = `Set ${gameState.currentSet}`;
        const gameType = gameState.isTiebreak
          ? gameState.currentSet === 3 &&
            gameState.matchFormat === "supertiebreak"
            ? "Super Tiebreak (to 10)"
            : "Tiebreak (to 7)"
          : "Regular Game";
        document.getElementById(
          "matchInfo"
        ).textContent = `${setInfo} | ${gameType}`;

        // Show serving indicator
        document.getElementById("serve1").style.display =
          gameState.servingTeam === "team1" ? "inline-block" : "none";
        document.getElementById("serve2").style.display =
          gameState.servingTeam === "team2" ? "inline-block" : "none";

        // Update format selector
        if (gameState.matchFormat === "supertiebreak") {
          document.getElementById("formatSuper").classList.add("active");
          document.getElementById("formatThird").classList.remove("active");
          document.querySelector('input[value="supertiebreak"]').checked = true;
        } else {
          document.getElementById("formatThird").classList.add("active");
          document.getElementById("formatSuper").classList.remove("active");
          document.querySelector('input[value="thirdset"]').checked = true;
        }
      }

      function formatPoints(myPoints, oppPoints) {
        if (myPoints < 40) return myPoints;
        if (myPoints === 40) return 40;
        return myPoints;
      }

      async function handlePoint(team) {
        if (isUpdating) return;
        isUpdating = true;

        try {
          const opponent = team === "team1" ? "team2" : "team1";

          if (gameState.isTiebreak) {
            gameState[`${team}Points`]++;
            await checkTiebreakWin(team, opponent);
          } else {
            await handleRegularPoint(team, opponent);
          }

          await saveState();
        } catch (error) {
          console.error("Error handling point:", error);
        } finally {
          isUpdating = false;
        }
      }

      async function handleRegularPoint(team, opponent) {
        const myPoints = gameState[`${team}Points`];
        const oppPoints = gameState[`${opponent}Points`];

        // Standard point progression: 0, 15, 30, 40
        if (myPoints === 0) {
          gameState[`${team}Points`] = 15;
        } else if (myPoints === 15) {
          gameState[`${team}Points`] = 30;
        } else if (myPoints === 30) {
          gameState[`${team}Points`] = 40;
        } else if (myPoints === 40) {
          // At 40, next point wins the game (even if opponent is at 40 - no advantage rule)
          await winGame(team, opponent);
        }
      }

      async function winGame(team, opponent) {
        gameState[`${team}Games`]++;
        gameState.team1Points = 0;
        gameState.team2Points = 0;
        switchServe();

        const myGames = gameState[`${team}Games`];
        const oppGames = gameState[`${opponent}Games`];

        // Check for set win
        if (myGames >= 6 && myGames - oppGames >= 2) {
          await winSet(team);
        } else if (myGames === 7) {
          await winSet(team);
        } else if (myGames === 6 && oppGames === 6) {
          // Start tiebreak
          gameState.isTiebreak = true;
        }
      }

      async function winSet(team) {
        gameState[`${team}Sets`]++;
        gameState.team1Games = 0;
        gameState.team2Games = 0;
        gameState.team1Points = 0;
        gameState.team2Points = 0;
        gameState.isTiebreak = false;
        gameState.currentSet++;

        // Check if sets are 1-1
        if (gameState.team1Sets === 1 && gameState.team2Sets === 1) {
          if (gameState.matchFormat === "supertiebreak") {
            // Start super tiebreak
            gameState.isTiebreak = true;
            gameState.currentSet = 3;
          } else {
            // Continue to third set
            gameState.currentSet = 3;
          }
        }

        // Check for match win
        if (gameState[`${team}Sets`] === 2) {
          setTimeout(() => {
            alert(
              `ðŸŽ‰ ${gameState[`${team}Name`]} wins the match! Congratulations!`
            );
          }, 100);
        }
      }

      async function checkTiebreakWin(team, opponent) {
        const myPoints = gameState[`${team}Points`];
        const oppPoints = gameState[`${opponent}Points`];

        // Super tiebreak (to 10) when it's the 3rd set with supertiebreak format
        // Regular tiebreak (to 7) for 6-6 in any set
        const target =
          gameState.currentSet === 3 &&
          gameState.matchFormat === "supertiebreak"
            ? 10
            : 7;

        if (myPoints >= target && myPoints - oppPoints >= 2) {
          await winSet(team);
        }
      }

      function switchServe() {
        gameState.servingTeam =
          gameState.servingTeam === "team1" ? "team2" : "team1";
      }

      async function adjustPoints(team, change) {
        if (isUpdating) return;
        isUpdating = true;

        try {
          if (gameState.isTiebreak) {
            gameState[`${team}Points`] = Math.max(
              0,
              gameState[`${team}Points`] + change
            );
          } else {
            const currentPoints = gameState[`${team}Points`];
            if (change < 0) {
              if (currentPoints === 40) gameState[`${team}Points`] = 30;
              else if (currentPoints === 30) gameState[`${team}Points`] = 15;
              else if (currentPoints === 15) gameState[`${team}Points`] = 0;
            }
          }
          await saveState();
        } catch (error) {
          console.error("Error adjusting points:", error);
        } finally {
          isUpdating = false;
        }
      }

      async function resetAll() {
        if (confirm("Are you sure you want to reset the entire match?")) {
          isUpdating = true;
          try {
            gameState = {
              team1Name: gameState.team1Name,
              team2Name: gameState.team2Name,
              team1Sets: 0,
              team2Sets: 0,
              team1Games: 0,
              team2Games: 0,
              team1Points: 0,
              team2Points: 0,
              isTiebreak: false,
              currentSet: 1,
              servingTeam: "team1",
              matchFormat: gameState.matchFormat,
            };
            await saveState();
          } catch (error) {
            console.error("Error resetting:", error);
          } finally {
            isUpdating = false;
          }
        }
      }

      async function setMatchFormat(format) {
        if (
          gameState.team1Sets > 0 ||
          gameState.team2Sets > 0 ||
          gameState.team1Games > 0 ||
          gameState.team2Games > 0
        ) {
          if (
            !confirm(
              "Changing match format will reset the current match. Continue?"
            )
          ) {
            // Revert radio button
            updateUI();
            return;
          }
        }

        isUpdating = true;
        try {
          gameState = {
            team1Name: gameState.team1Name,
            team2Name: gameState.team2Name,
            team1Sets: 0,
            team2Sets: 0,
            team1Games: 0,
            team2Games: 0,
            team1Points: 0,
            team2Points: 0,
            isTiebreak: false,
            currentSet: 1,
            servingTeam: "team1",
            matchFormat: format,
          };
          await saveState();
        } catch (error) {
          console.error("Error setting format:", error);
        } finally {
          isUpdating = false;
        }
      }

      async function saveState() {
        await scoreboardRef.set(gameState);
        updateUI();
      }

      // Team Name Handlers
      document
        .getElementById("team1NameInput")
        .addEventListener("blur", async (e) => {
          if (e.target.value.trim()) {
            gameState.team1Name = e.target.value.trim();
            await saveState();
          }
        });

      document
        .getElementById("team2NameInput")
        .addEventListener("blur", async (e) => {
          if (e.target.value.trim()) {
            gameState.team2Name = e.target.value.trim();
            await saveState();
          }
        });

      // Initial Load
      scoreboardRef.get().then((doc) => {
        if (doc.exists) {
          gameState = doc.data();
          updateUI();
          document.getElementById("team1NameInput").value =
            gameState.team1Name !== "Team 1" ? gameState.team1Name : "";
          document.getElementById("team2NameInput").value =
            gameState.team2Name !== "Team 2" ? gameState.team2Name : "";
        }
      });
    </script>
  </body>
</html>
